---
// Check if already has admin session
const adminSession = Astro.cookies.get('admin-session')?.value;
if (adminSession === 'verified') {
  return Astro.redirect('/dashboard/admin');
}
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Login ‚Äì Keto Journey</title>
  <style>
    :root{--bg-primary:#fff;--bg-secondary:#f9fafb;--text-primary:#111827;--text-secondary:#6b7280;--border-color:#e5e7eb;--accent-primary:#10b981;--shadow-xl:0 20px 25px rgba(0,0,0,.15);}
    [data-theme="dark"]{--bg-primary:#1a1a2e;--bg-secondary:#16213e;--text-primary:#eaeaea;--text-secondary:#a0aec0;--border-color:#2d3748;}
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem;}
    
    .login-container{background:var(--bg-primary);border-radius:2rem;padding:3rem;max-width:450px;width:100%;box-shadow:var(--shadow-xl);position:relative;overflow:hidden;}
    .login-container::before{content:'';position:absolute;top:-50%;right:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(102,126,234,.05) 0%,transparent 70%);animation:rotate 20s linear infinite;}
    @keyframes rotate{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}
    
    .lock-icon{width:5rem;height:5rem;background:linear-gradient(135deg,#ef4444,#dc2626);border-radius:1.5rem;display:flex;align-items:center;justify-content:center;font-size:3rem;margin:0 auto 2rem;box-shadow:0 10px 30px rgba(239,68,68,.3);position:relative;z-index:1;}
    
    h1{font-size:2rem;font-weight:900;text-align:center;margin-bottom:.5rem;background:linear-gradient(135deg,#ef4444,#dc2626);-webkit-background-clip:text;-webkit-text-fill-color:transparent;position:relative;z-index:1;}
    
    p{text-align:center;color:var(--text-secondary);margin-bottom:2rem;position:relative;z-index:1;}
    
    .form-group{margin-bottom:1.5rem;position:relative;z-index:1;}
    label{display:block;font-size:.875rem;font-weight:700;color:var(--text-primary);margin-bottom:.5rem;}
    
    input{width:100%;padding:1rem 1.5rem;border:2px solid var(--border-color);border-radius:1rem;background:var(--bg-secondary);color:var(--text-primary);font-size:1rem;transition:all .3s;}
    input:focus{outline:none;border-color:#ef4444;box-shadow:0 0 0 3px rgba(239,68,68,.1);}
    
    .btn{width:100%;padding:1.25rem;border:none;border-radius:1.25rem;background:linear-gradient(135deg,#ef4444,#dc2626);color:white;font-size:1.125rem;font-weight:800;cursor:pointer;transition:all .3s;margin-top:1rem;display:flex;align-items:center;justify-content:center;gap:.75rem;}
    .btn:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(239,68,68,.4);}
    .btn:disabled{opacity:.5;cursor:not-allowed;transform:none;}
    
    .error{background:rgba(239,68,68,.1);border:2px solid #ef4444;border-radius:1rem;padding:1rem;color:#dc2626;font-weight:600;text-align:center;margin-bottom:1rem;display:none;}
    .error.show{display:block;animation:shake .5s;}
    @keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-10px);}75%{transform:translateX(10px);}}
    
    .back-link{text-align:center;margin-top:1.5rem;position:relative;z-index:1;}
    .back-link a{color:var(--text-secondary);text-decoration:none;font-weight:600;transition:all .3s;}
    .back-link a:hover{color:#ef4444;}
    
    .theme-toggle{position:absolute;top:1.5rem;right:1.5rem;width:48px;height:48px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.5rem;box-shadow:0 4px 12px rgba(0,0,0,.2);transition:all .3s;z-index:10;}
    .theme-toggle:hover{transform:scale(1.1);}
  </style>
</head>
<body>

<div class="theme-toggle" id="themeToggle">
  <span id="themeIcon">‚òÄÔ∏è</span>
</div>

<div class="login-container">
  <div class="lock-icon">üîê</div>
  <h1>Admin Access</h1>
  <p>Enter admin password to continue</p>
  
  <div id="errorMessage" class="error"></div>
  
  <form id="loginForm">
    <div class="form-group">
      <label for="password">Admin Password</label>
      <input 
        type="password" 
        id="password" 
        name="password" 
        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
        required 
        autofocus
      />
    </div>
    
    <button type="submit" class="btn" id="submitBtn">
      <span>üîì</span>
      <span>Unlock Admin Panel</span>
    </button>
  </form>
  
  <div class="back-link">
    <a href="/dashboard/">‚Üê Back to Dashboard</a>
  </div>
</div>

<script is:inline>
  // Dark Mode
  const html=document.documentElement;
  const themeIcon=document.getElementById('themeIcon');
  const saved=localStorage.getItem('theme')||'light';
  html.setAttribute('data-theme',saved);
  if(themeIcon)themeIcon.textContent=saved==='dark'?'üåô':'‚òÄÔ∏è';
  document.getElementById('themeToggle')?.addEventListener('click',function(){
    const next=html.getAttribute('data-theme')==='dark'?'light':'dark';
    html.setAttribute('data-theme',next);
    if(themeIcon)themeIcon.textContent=next==='dark'?'üåô':'‚òÄÔ∏è';
    localStorage.setItem('theme',next);
  });

  // Login Form
  const form = document.getElementById('loginForm');
  const errorMsg = document.getElementById('errorMessage');
  const submitBtn = document.getElementById('submitBtn');
  const passwordInput = document.getElementById('password');

  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const password = passwordInput.value;
    
    // Disable button
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span>‚è≥</span><span>Verifying...</span>';
    
    // Hide previous error
    errorMsg.classList.remove('show');
    
    try {
      const response = await fetch('/api/admin/verify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password })
      });
      
      const result = await response.json();
      
      if (response.ok && result.success) {
        // Success!
        submitBtn.innerHTML = '<span>‚úÖ</span><span>Access Granted!</span>';
        submitBtn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
        
        // Redirect after brief delay
        setTimeout(() => {
          window.location.href = '/dashboard/admin';
        }, 800);
      } else {
        // Wrong password
        errorMsg.textContent = '‚ùå ' + (result.error || 'Invalid password. Please try again.');
        errorMsg.classList.add('show');
        
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<span>üîì</span><span>Unlock Admin Panel</span>';
        
        // Clear password field
        passwordInput.value = '';
        passwordInput.focus();
      }
    } catch (error) {
      errorMsg.textContent = '‚ùå Connection error. Please try again.';
      errorMsg.classList.add('show');
      
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<span>üîì</span><span>Unlock Admin Panel</span>';
    }
  });

  console.log('‚úÖ Admin login page loaded');
</script>
</body>
</html>